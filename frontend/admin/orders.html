<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý đơn hàng - Mihn Cosmetics Admin</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/admin.css">
</head>

<body>
    <div class="admin-layout">
        <aside class="admin-sidebar">
            <div class="admin-logo">
                <div class="admin-logo-icon"><i class="fas fa-bottle-droplet"></i></div><span>Mihn Cosmetics</span>
            </div>
            <nav class="admin-nav">
                <a href="dashboard.html" class="admin-nav-link"><i
                        class="fas fa-chart-pie"></i><span>Dashboard</span></a>
                <a href="products.html" class="admin-nav-link"><i class="fas fa-box"></i><span>Sản phẩm</span></a>
                <a href="categories.html" class="admin-nav-link"><i class="fas fa-tags"></i><span>Danh mục</span></a>
                <a href="coupons.html" class="admin-nav-link"><i class="fas fa-ticket"></i><span>Mã giảm giá</span></a>
                <a href="batches.html" class="admin-nav-link"><i class="fas fa-layer-group"></i><span>Lô hàng</span></a>
                <a href="orders.html" class="admin-nav-link active"><i class="fas fa-shopping-cart"></i><span>Đơn
                        hàng</span></a>
                <a href="customers.html" class="admin-nav-link"><i class="fas fa-users"></i><span>Khách hàng</span></a>
                <a href="../index.html" class="admin-nav-link" style="margin-top:auto;"><i
                        class="fas fa-store"></i><span>Cửa hàng</span></a>
            </nav>
        </aside>
        <main class="admin-main">
            <header class="admin-header">
                <h1 class="admin-page-title">Quản lý đơn hàng</h1>
            </header>
            <div class="admin-content">
                <div style="display:flex;gap:1rem;margin-bottom:1.5rem;">
                    <select class="form-input form-select" id="statusFilter" style="max-width:180px;">
                        <option value="">Tất cả</option>
                        <option value="pending">Chờ xác nhận</option>
                        <option value="confirmed">Đã xác nhận</option>
                        <option value="shipping">Đang giao</option>
                        <option value="delivered">Đã giao</option>
                        <option value="cancelled">Đã hủy</option>
                    </select>
                    <button class="btn btn-secondary" onclick="load()"><i class="fas fa-filter"></i> Lọc</button>
                </div>
                <div class="admin-table-card">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Mã</th>
                                <th>Khách hàng</th>
                                <th>SĐT</th>
                                <th>Tổng</th>
                                <th>Trạng thái</th>
                                <th>Ngày</th>
                                <th>Hành động</th>
                            </tr>
                        </thead>
                        <tbody id="table">
                            <tr>
                                <td colspan="7" style="text-align:center;padding:2rem;">
                                    <div class="spinner" style="margin:auto;"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>
    <div class="toast-container"></div>
    <script src="../js/api.js"></script>
    <script>
        if (!Utils.isLoggedIn() || !Utils.isAdmin()) location.href = '../login.html';
        const statusMap = { pending: { t: 'Chờ xác nhận', c: 'status-pending' }, confirmed: { t: 'Đã xác nhận', c: 'status-confirmed' }, shipping: { t: 'Đang giao', c: 'status-shipping' }, delivered: { t: 'Đã giao', c: 'status-delivered' }, cancelled: { t: 'Đã hủy', c: 'status-cancelled' } };
        async function load() { const status = document.getElementById('statusFilter').value; const r = await API.orders.getAll({ status, limit: 50 }); render(r.data); }
        function render(data) {
            const t = document.getElementById('table'); if (!data.length) { t.innerHTML = '<tr><td colspan="7" style="text-align:center;padding:2rem;color:#888;">Không có đơn hàng</td></tr>'; return; }
            t.innerHTML = data.map(o => `<tr><td><b>#${o.id}</b></td><td>${o.customer_name}</td><td>${o.phone || '-'}</td><td><b>${Utils.formatCurrency(o.total_amount)}</b></td><td><span class="status-badge ${statusMap[o.status].c}">${statusMap[o.status].t}</span></td><td>${Utils.formatDate(o.created_at)}</td><td><select class="form-input" style="padding:0.5rem;font-size:0.875rem;" onchange="updateStatus(${o.id},this.value)"><option value="pending" ${o.status === 'pending' ? 'selected' : ''}>Chờ xác nhận</option><option value="confirmed" ${o.status === 'confirmed' ? 'selected' : ''}>Xác nhận</option><option value="shipping" ${o.status === 'shipping' ? 'selected' : ''}>Đang giao</option><option value="delivered" ${o.status === 'delivered' ? 'selected' : ''}>Đã giao</option><option value="cancelled" ${o.status === 'cancelled' ? 'selected' : ''}>Hủy</option></select></td></tr>`).join('');
        }
        async function updateStatus(id, status) { try { await API.orders.updateStatus(id, status); Utils.showToast('Đã cập nhật', 'success'); load(); } catch (e) { Utils.showToast(e.message, 'error'); } }
        load();
    </script>
</body>

</html>